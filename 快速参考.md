# ğŸ“˜ Rez åŒ…ç®¡ç†ç³»ç»Ÿå¿«é€Ÿå‚è€ƒ

## ğŸ¯ 5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨

### 1. éªŒè¯å®‰è£…
```powershell
python -c "import rez; print(f'âœ“ Rez {rez.__version__} å·²å®‰è£…')"
```

### 2. æŸ¥çœ‹æœ¬åœ°åŒ…
```powershell
$env:REZ_PACKAGES_PATH = "E:\UE\RezTest\my_packages"
python -c "from rez import packages; print([f.name for f in packages.iter_package_families()])"
```

### 3. è·å–åŒ…ä¿¡æ¯
```powershell
python -c "from rez import packages; pkg = packages.get_package('myapp', '1.0.0'); print(f'åç§°: {pkg.name}\nç‰ˆæœ¬: {pkg.version}\næè¿°: {pkg.description}')"
```

---

## ğŸ“ Package.py å®Œæ•´ç¤ºä¾‹

```python
"""
ç¤ºä¾‹ Rez åŒ…é…ç½®æ–‡ä»¶
"""

# ===== å¿…éœ€å­—æ®µ =====
name = "myapp"
version = "1.0.0"

# ===== æ¨èå­—æ®µ =====
description = "My Application"
authors = ["Your Name"]

# ===== ä¾èµ–é¡¹ï¼ˆå¯é€‰ï¼‰ =====
requires = [
    "python-3.9+<4",      # Python 3.9 åˆ° 3.x
    "maya-2022+",         # Maya 2022 åŠä»¥ä¸Š
]

# ===== ç³»ç»Ÿéœ€æ±‚ï¼ˆå¯é€‰ï¼‰ =====
system_requires = []

# ===== ç¯å¢ƒé…ç½® =====
def commands():
    """åœ¨åŠ è½½åŒ…ç¯å¢ƒæ—¶æ‰§è¡Œ"""
    import os
    import platform
    
    # æ·»åŠ åˆ° PATHï¼ˆå‰ç¼€ï¼‰
    env.PATH.prepend("{root}/bin")
    
    # æ·»åŠ åˆ° PATHï¼ˆåç¼€ï¼‰
    env.PATH.append("{root}/lib")
    
    # è®¾ç½®è‡ªå®šä¹‰ç¯å¢ƒå˜é‡
    env.MYAPP_ROOT = "{root}"
    env.MYAPP_VERSION = "{version}"
    
    # å¹³å°ç‰¹å®šé…ç½®
    if platform.system() == "Windows":
        env.PATH.append("{root}/bin/windows")
    else:
        env.PATH.append("{root}/bin/linux")

# ===== å˜ä½“ï¼ˆå¯é€‰ï¼‰ =====
variants = [
    ["python-3.9"],
    ["python-3.10"],
    ["python-3.11"],
]

# ===== é«˜çº§é…ç½® =====

# è§£æå‰çš„å›è°ƒ
pre_resolve_function = None

# è§£æåçš„å›è°ƒ  
post_resolve_function = None

# è§£æå¤±è´¥æ—¶çš„å›è°ƒ
graph_build_function = None

# å…¶ä»–å¯é€‰å­—æ®µ
help = "This is my application"
keywords = ["tool", "utility"]
"""
```

---

## ğŸ—‚ï¸ åŒ…ç›®å½•ç»“æ„

```
my_package/
â”‚
â”œâ”€â”€ package.py                    # åŒ…é…ç½®æ–‡ä»¶ï¼ˆå¿…éœ€ï¼‰
â”œâ”€â”€ README.md                     # æ–‡æ¡£
â”‚
â”œâ”€â”€ bin/                          # å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ myapp.py
â”‚   â”œâ”€â”€ myapp.sh
â”‚   â””â”€â”€ windows/
â”‚       â””â”€â”€ myapp.bat
â”‚
â”œâ”€â”€ lib/                          # åº“æ–‡ä»¶
â”‚   â”œâ”€â”€ myapp/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ core.py
â”‚   â”‚   â””â”€â”€ utils.py
â”‚   â””â”€â”€ config.py
â”‚
â”œâ”€â”€ src/                          # æºä»£ç ï¼ˆå¯é€‰ï¼‰
â”‚   â””â”€â”€ myapp/
â”‚       â””â”€â”€ ...
â”‚
â””â”€â”€ resources/                    # èµ„æºæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ config/
    â”‚   â””â”€â”€ default.yaml
    â””â”€â”€ data/
        â””â”€â”€ sample.txt
```

---

## ğŸ”— ç‰ˆæœ¬çº¦æŸè¯­æ³•

```python
# åŸºç¡€
"1.0.0"              # ç²¾ç¡®ç‰ˆæœ¬
"1.0.0+"             # 1.0.0 åŠä»¥ä¸Š

# èŒƒå›´
"1.0+<2"             # 1.0 åˆ° 2.0ï¼ˆä¸å« 2.0ï¼‰
"1.0,<2"             # 1.x æˆ–æ›´é«˜ï¼ˆä½† < 2.0ï¼‰

# å¤šé€‰
"1.0,1.5,1.9"        # ä»…è¿™äº›ç‰ˆæœ¬

# å®é™…ç¤ºä¾‹
requires = [
    "python-3.9+<4",              # Python 3.9 ç³»åˆ—
    "maya-2020+",                 # Maya 2020 åŠä»¥ä¸Š
    "perforce-2021.1,2021.2",     # ç‰¹å®šç‰ˆæœ¬
]
```

---

## ğŸ’» Python API ä½¿ç”¨

### åˆ—å‡ºåŒ…

```python
from rez import packages

# åˆ—å‡ºæ‰€æœ‰åŒ…æ—
for family in packages.iter_package_families():
    print(family.name)

# åˆ—å‡ºç‰¹å®šåŒ…çš„æ‰€æœ‰ç‰ˆæœ¬
for pkg in packages.iter_packages("myapp"):
    print(f"{pkg.name}-{pkg.version}")
```

### è·å–åŒ…ä¿¡æ¯

```python
from rez import packages

# è·å–ç‰¹å®šç‰ˆæœ¬çš„åŒ…
pkg = packages.get_package("myapp", "1.0.0")

# æˆ–è€…ä»å­—ç¬¦ä¸²è·å–
pkg = packages.get_package_from_string("myapp-1.0.0")

# è®¿é—®å±æ€§
print(f"åç§°: {pkg.name}")
print(f"ç‰ˆæœ¬: {pkg.version}")
print(f"æè¿°: {pkg.description}")
print(f"ä½œè€…: {pkg.authors}")
```

### ç‰ˆæœ¬æ“ä½œ

```python
from rez.version import Version, VersionRange

# åˆ›å»ºç‰ˆæœ¬å¯¹è±¡
v = Version("1.2.3")
print(f"ä¸»ç‰ˆæœ¬: {v.major}")
print(f"æ¬¡ç‰ˆæœ¬: {v.minor}")

# ç‰ˆæœ¬èŒƒå›´
r = VersionRange("1.0+<2")
v2 = Version("1.5.0")
print(f"1.5.0 åœ¨èŒƒå›´å†…: {v2 in r}")  # True
```

### è§£æç¯å¢ƒ

```python
from rez.resolved_context import ResolvedContext

# åˆ›å»ºç¯å¢ƒ
context = ResolvedContext(["myapp", "python-3.9"])

# æŸ¥çœ‹å·²è§£æçš„åŒ…
for pkg in context.resolved_packages:
    print(pkg)

# è·å–ç¯å¢ƒå˜é‡
print(context.get_environ())
```

---

## ğŸ› ï¸ å¸¸ç”¨ä»»åŠ¡

### ä»»åŠ¡ 1ï¼šåˆ›å»ºåŒ…

```powershell
# 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p my_packages\myapp\1.0.0\bin
mkdir -p my_packages\myapp\1.0.0\lib

# 2. åˆ›å»º package.pyï¼ˆè§ä¸Šé¢çš„ç¤ºä¾‹ï¼‰

# 3. éªŒè¯é…ç½®
python -c "
from rez import packages
pkg = packages.get_package('myapp', '1.0.0')
print(f'âœ“ åŒ…å·²åˆ›å»º: {pkg.name}-{pkg.version}')
"
```

### ä»»åŠ¡ 2ï¼šä½¿ç”¨åŒ…

```powershell
# 1. è®¾ç½®åŒ…æœç´¢è·¯å¾„
$env:REZ_PACKAGES_PATH = "E:\UE\RezTest\my_packages"

# 2. åˆ—å‡ºå¯ç”¨åŒ…
python -c "from rez import packages; families = list(packages.iter_package_families()); print(f'å¯ç”¨åŒ…: {[f.name for f in families]}')"

# 3. è·å–åŒ…ä¿¡æ¯
python -c "
from rez import packages
pkg = packages.get_package('myapp', '1.0.0')
print(f'åŒ…: {pkg.name}')
print(f'ç‰ˆæœ¬: {pkg.version}')
print(f'ä¾èµ–: {pkg.requires}')
print(f'å˜ä½“: {pkg.variants}')
"
```

### ä»»åŠ¡ 3ï¼šåˆ›å»ºç¯å¢ƒ

```powershell
# åˆ›å»ºåŒ…å« myapp çš„ç¯å¢ƒ
python -c "
from rez.resolved_context import ResolvedContext
ctx = ResolvedContext(['myapp'])
print(f'è§£æäº† {len(ctx.resolved_packages)} ä¸ªåŒ…')
for pkg in ctx.resolved_packages:
    print(f'  - {pkg}')
"
```

### ä»»åŠ¡ 4ï¼šè®¾ç½®ç¯å¢ƒå˜é‡

åœ¨ `package.py` çš„ `commands()` å‡½æ•°ä¸­ï¼š

```python
def commands():
    import os
    
    # è·¯å¾„æ“ä½œ
    env.PATH.prepend("{root}/bin")           # å‰ç¼€
    env.PATH.append("{root}/lib")            # åç¼€
    env.PATH.remove("C:/unwanted/path")      # ç§»é™¤
    env.PATH.clear()                         # æ¸…ç©º
    
    # è®¾ç½®å˜é‡
    env.MYAPP_HOME = "{root}"
    env.MYAPP_VERSION = "{version}"
    env.MYAPP_NAME = "{name}"
    
    # æ¡ä»¶æ“ä½œ
    if "{variant}" == "python-3.9":
        env.PYTHON_VERSION = "3.9"
    
    # è¿½åŠ /å‰ç¼€
    env.PYTHONPATH.append("{root}/lib/python")
    env.CXXFLAGS.prepend("-Wall")
```

---

## ğŸ“Š ç‰¹æ®Šå ä½ç¬¦

| å ä½ç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `{root}` | åŒ…çš„æ ¹ç›®å½• | `/path/to/myapp/1.0.0` |
| `{name}` | åŒ…å | `myapp` |
| `{version}` | ç‰ˆæœ¬å· | `1.0.0` |
| `{variant}` | å½“å‰å˜ä½“ | `python-3.9` |
| `{arch}` | ç³»ç»Ÿæ¶æ„ | `linux` |

---

## â“ å¸¸è§é—®é¢˜è§£ç­”

### Q: åŒ…æ‰¾ä¸åˆ°ï¼Ÿ
```powershell
# æ£€æŸ¥æœç´¢è·¯å¾„
python -c "
from rez.config import config
print('åŒ…æœç´¢è·¯å¾„:')
for path in config.packages_path:
    print(f'  {path}')
"

# æ·»åŠ è‡ªå®šä¹‰è·¯å¾„
$env:REZ_PACKAGES_PATH = "E:\UE\RezTest\my_packages;$env:REZ_PACKAGES_PATH"
```

### Q: ç‰ˆæœ¬å†²çªæ€ä¹ˆåŠï¼Ÿ
```python
# Rez ä¼šè‡ªåŠ¨å°è¯•è§£å†³
# å¦‚æœæ— æ³•è§£å†³ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸
try:
    from rez.resolved_context import ResolvedContext
    ctx = ResolvedContext(["python-3.7", "python-3.9"])
except Exception as e:
    print(f"å†²çª: {e}")
```

### Q: å¦‚ä½•è°ƒè¯•ç¯å¢ƒå˜é‡ï¼Ÿ
```python
from rez.resolved_context import ResolvedContext

ctx = ResolvedContext(["myapp"])
env = ctx.get_environ()

# æ‰“å°æ‰€æœ‰ç¯å¢ƒå˜é‡
for key, value in sorted(env.items()):
    print(f"{key}={value}")
```

### Q: å¦‚ä½•å¸è½½åŒ…ï¼Ÿ
```powershell
# ç›´æ¥åˆ é™¤åŒ…ç›®å½•
rm -r E:\UE\RezTest\my_packages\myapp\1.0.0
```

### Q: å¦‚ä½•æŸ¥çœ‹å·²å®‰è£…çš„åŒ…ï¼Ÿ
```powershell
python -c "
from rez import packages
import os
os.environ['REZ_PACKAGES_PATH'] = 'E:\UE\RezTest\my_packages'

families = list(packages.iter_package_families())
for family in families:
    versions = [str(p.version) for p in packages.iter_packages(family.name)]
    print(f'{family.name}: {versions}')
"
```

---

## ğŸ“š èµ„æºé“¾æ¥

- ğŸ“– [Rez å®˜æ–¹æ–‡æ¡£](https://rez.readthedocs.io/)
- ğŸ™ [GitHub ä»“åº“](https://github.com/nerdvegas/rez)
- ğŸ’¬ [Slack ç¤¾åŒº](https://rezdevelop.slack.com/)
- ğŸ¥ [æ•™ç¨‹è§†é¢‘](https://www.youtube.com/results?search_query=rez+package+manager)

---

## ğŸ“‚ æœ¬é¡¹ç›®æ–‡ä»¶è¯´æ˜

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `test.py` | Rez åŸºç¡€åŠŸèƒ½æ¼”ç¤º |
| `create_package_example.py` | åˆ›å»ºç¤ºä¾‹åŒ…è„šæœ¬ |
| `practice_test.py` | Rez API å®è·µæµ‹è¯• |
| `REZ_å®Œæ•´æŒ‡å—.md` | è¯¦ç»†ä½¿ç”¨æŒ‡å— |
| `my_packages/myapp/` | ç¤ºä¾‹åŒ…ç›®å½• |

---

**å¿«é€Ÿå¼€å§‹å‘½ä»¤ï¼š**

```powershell
# 1. è¿è¡Œæ¼”ç¤º
python test.py

# 2. æŸ¥çœ‹ç¤ºä¾‹åŒ…ä¿¡æ¯
$env:REZ_PACKAGES_PATH = "E:\UE\RezTest\my_packages"
python -c "from rez import packages; pkg = packages.get_package('myapp', '1.0.0'); print(pkg.description)"

# 3. åˆ›å»ºæ–°åŒ…ï¼ˆä¿®æ”¹è„šæœ¬ä¸­çš„å‚æ•°ï¼‰
python create_package_example.py

# 4. æŸ¥çœ‹å®Œæ•´æŒ‡å—
cat REZ_å®Œæ•´æŒ‡å—.md
```

---

âœ… **ç°åœ¨æ‚¨å·²æŒæ¡ Rez çš„åŸºæœ¬ç”¨æ³•ï¼å¼€å§‹æ„å»ºæ‚¨çš„åŒ…ç®¡ç†ç³»ç»Ÿå§ï¼**
